<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:12,&quot;tests&quot;:46,&quot;passes&quot;:46,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2023-09-22T20:45:17.687Z&quot;,&quot;end&quot;:&quot;2023-09-22T20:46:14.523Z&quot;,&quot;duration&quot;:56836,&quot;testsRegistered&quot;:46,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;8bfd772c-6480-46c7-bb8e-657e1681cfe8&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5c0be614-f624-4f74-ae17-1935f89a422b&quot;,&quot;title&quot;:&quot;Minter - Deposit Withdraw&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Minter - Deposit Withdraw\&quot;&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw \&quot;before each\&quot; hook in \&quot;Minter - Deposit Withdraw\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = await hre.deployments.fixture(fixtureName);\nawait _hardhatnetworkhelpers.time.increase(3602);\nif (result.Diamond) {\n    hre.Diamond = (0, _redstone.wrapKresko)(await hre.getContractOrFork(\&quot;Kresko\&quot;));\n}\nthis.facets = result.Diamond?.facets?.length ? result.Diamond.facets : [];\nthis.collaterals = hre.collaterals;\nthis.krAssets = hre.krAssets;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b903337-4454-4e93-9e54-5e5eeffdb476&quot;,&quot;parentUUID&quot;:&quot;5c0be614-f624-4f74-ae17-1935f89a422b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Minter - Deposit Withdraw\&quot;&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw \&quot;before each\&quot; hook in \&quot;Minter - Deposit Withdraw\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;user = _hardhat.default.users.userThree;\nUserKresko = (0, _redstone.wrapKresko)(_hardhat.default.Diamond, user);\nthis.collateral = this.collaterals.find((c)=&gt;c.deployArgs.name === _testutils.defaultCollateralArgs.name);\nthis.krAsset = this.krAssets.find((k)=&gt;k.deployArgs.name === _testutils.defaultKrAssetArgs.name);\nCollateral2 = this.collaterals.find((c)=&gt;c.deployArgs.name === \&quot;MockCollateral2\&quot;);\nKreskoAssetCollateral = this.krAssets.find((k)=&gt;k.deployArgs.name === \&quot;MockKreskoAssetCollateral\&quot;);\nthis.initialBalance = (0, _lib.toBig)(100000);\nawait this.collateral.contract.setVariable(\&quot;_balances\&quot;, {\n    [_hardhat.default.users.userOne.address]: this.initialBalance\n});\nawait this.collateral.contract.setVariable(\&quot;_allowances\&quot;, {\n    [_hardhat.default.users.userOne.address]: {\n        [_hardhat.default.Diamond.address]: this.initialBalance\n    }\n});\ndepositArgs = {\n    user: _hardhat.default.users.userOne,\n    asset: this.collateral,\n    amount: (0, _lib.toBig)(10000)\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3bec50d9-f724-4dbd-801a-9871238d7b40&quot;,&quot;parentUUID&quot;:&quot;5c0be614-f624-4f74-ae17-1935f89a422b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fdaf66e1-76ba-487c-ac28-bf0f3fd2bc31&quot;,&quot;title&quot;:&quot;#collateral&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;title&quot;:&quot;#deposit&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;reverts withdraws of krAsset collateral when deposits go below MIN_KRASSET_COLLATERAL_AMOUNT&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit reverts withdraws of krAsset collateral when deposits go below MIN_KRASSET_COLLATERAL_AMOUNT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:556,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const collateralAmount = (0, _lib.toBig)(100);\nconst KreskoAssetCollateral = this.krAssets.find((kr)=&gt;kr.deployArgs.name === \&quot;MockKreskoAssetCollateral\&quot;);\nawait KreskoAssetCollateral.setBalance(user, collateralAmount, _hardhat.default.Diamond.address);\nconst depositAmount = collateralAmount.div(2);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, depositAmount);\n// Rebase the asset according to params\nconst denominator = 4;\nconst positive = true;\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst rebasedDepositAmount = depositAmount.mul(denominator);\nconst withdrawAmount = rebasedDepositAmount.sub(9e11.toString());\n(0, _chai.expect)(await _hardhat.default.Diamond.getAccountCollateralAssets(user.address)).to.include(KreskoAssetCollateral.address);\nawait (0, _chai.expect)(UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, withdrawAmount, 0)).to.be.revertedWith(_errors.Error.COLLATERAL_AMOUNT_TOO_LOW);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;631ed92a-92eb-482d-9500-303ef2a82c58&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reverts deposits of krAsset collateral for less than MIN_KRASSET_COLLATERAL_AMOUNT&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit reverts deposits of krAsset collateral for less than MIN_KRASSET_COLLATERAL_AMOUNT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:116,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const collateralAmount = (0, _lib.toBig)(100);\nconst KreskoAssetCollateral = this.krAssets.find((kr)=&gt;kr.deployArgs.name === \&quot;MockKreskoAssetCollateral\&quot;);\nawait KreskoAssetCollateral.setBalance(user, collateralAmount, _hardhat.default.Diamond.address);\nawait (0, _chai.expect)(UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, 9e11.toString())).to.be.revertedWith(_errors.Error.COLLATERAL_AMOUNT_TOO_LOW);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6645b567-2f75-4ee4-b287-b9cd5fa0a30a&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow an account to deposit whitelisted collateral&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should allow an account to deposit whitelisted collateral&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:479,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Account has no deposited assets\nconst depositedCollateralAssetsBefore = await _hardhat.default.Diamond.getAccountCollateralAssets(depositArgs.user.address);\n(0, _chai.expect)(depositedCollateralAssetsBefore).to.deep.equal([]);\n// Deposit collateral\nawait (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user).depositCollateral(depositArgs.user.address, this.collateral.address, depositArgs.amount)).not.to.be.reverted;\n// Account now has deposited assets\nconst depositedCollateralAssetsAfter = await _hardhat.default.Diamond.getAccountCollateralAssets(depositArgs.user.address);\n(0, _chai.expect)(depositedCollateralAssetsAfter).to.deep.equal([\n    this.collateral.address\n]);\n// Account&#x27;s collateral deposit balances have increased\n(0, _chai.expect)(await _hardhat.default.Diamond.getAccountCollateralAmount(depositArgs.user.address, this.collateral.address)).to.equal(depositArgs.amount);\n// Kresko contract&#x27;s collateral balance has increased\n(0, _chai.expect)(await this.collateral.contract.balanceOf(_hardhat.default.Diamond.address)).to.equal(depositArgs.amount);\n// Account&#x27;s collateral balance has decreased\n(0, _chai.expect)((0, _lib.fromBig)(await this.collateral.contract.balanceOf(_hardhat.default.users.userOne.address))).to.equal((0, _lib.fromBig)(this.initialBalance) - (0, _lib.fromBig)(depositArgs.amount));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a19cbfe8-9d6d-4d57-b2f0-8f8ee34fdbf9&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow an arbitrary account to deposit whitelisted collateral on behalf of another account&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should allow an arbitrary account to deposit whitelisted collateral on behalf of another account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:447,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load arbitrary user with sufficient collateral for testing purposes\nawait this.collateral.contract.setVariable(\&quot;_balances\&quot;, {\n    [user.address]: this.initialBalance\n});\nawait this.collateral.contract.setVariable(\&quot;_allowances\&quot;, {\n    [user.address]: {\n        [_hardhat.default.Diamond.address]: this.initialBalance\n    }\n});\n// Initially, the array of the user&#x27;s deposited collateral assets should be empty.\nconst depositedCollateralAssetsBefore = await _hardhat.default.Diamond.getAccountCollateralAssets(depositArgs.user.address);\n(0, _chai.expect)(depositedCollateralAssetsBefore).to.deep.equal([]);\n// Deposit collateral\nawait (0, _chai.expect)(UserKresko.depositCollateral(depositArgs.user.address, this.collateral.address, depositArgs.amount)).not.to.be.reverted;\n// Confirm the array of the user&#x27;s deposited collateral assets has been pushed to.\nconst depositedCollateralAssetsAfter = await _hardhat.default.Diamond.getAccountCollateralAssets(depositArgs.user.address);\n(0, _chai.expect)(depositedCollateralAssetsAfter).to.deep.equal([\n    this.collateral.address\n]);\n// Confirm the amount deposited is recorded for the user.\nconst amountDeposited = await _hardhat.default.Diamond.getAccountCollateralAmount(depositArgs.user.address, this.collateral.address);\n(0, _chai.expect)(amountDeposited).to.equal(depositArgs.amount);\n// Confirm the amount as been transferred from the user into Kresko.sol\nconst kreskoBalance = await this.collateral.contract.balanceOf(_hardhat.default.Diamond.address);\n(0, _chai.expect)(kreskoBalance).to.equal(depositArgs.amount);\n// Confirm the depositor&#x27;s wallet balance has been adjusted accordingly\nconst depositorBalanceAfter = await this.collateral.contract.balanceOf(user.address);\n(0, _chai.expect)((0, _lib.fromBig)(depositorBalanceAfter)).to.equal((0, _lib.fromBig)(this.initialBalance) - (0, _lib.fromBig)(depositArgs.amount));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c7c0975a-0c07-4d42-a0d2-7e3c9e397490&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow an account to deposit more collateral to an existing deposit&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should allow an account to deposit more collateral to an existing deposit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:445,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const UserKresko = (0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user);\n// Deposit first batch of collateral\nawait (0, _chai.expect)(UserKresko.depositCollateral(depositArgs.user.address, this.collateral.address, depositArgs.amount)).not.to.be.reverted;\n// Deposit second batch of collateral\nawait (0, _chai.expect)(UserKresko.depositCollateral(depositArgs.user.address, this.collateral.address, depositArgs.amount)).not.to.be.reverted;\n// Confirm the array of the user&#x27;s deposited collateral assets hasn&#x27;t been double-pushed to.\nconst depositedCollateralAssetsAfter = await _hardhat.default.Diamond.getAccountCollateralAssets(depositArgs.user.address);\n(0, _chai.expect)(depositedCollateralAssetsAfter).to.deep.equal([\n    this.collateral.address\n]);\n// Confirm the amount deposited is recorded for the user.\nconst amountDeposited = await _hardhat.default.Diamond.getAccountCollateralAmount(depositArgs.user.address, this.collateral.address);\n(0, _chai.expect)(amountDeposited).to.equal(depositArgs.amount.add(depositArgs.amount));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;98d1cd1c-949e-42f7-9b41-a1c6a8b11bab&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow an account to have deposited multiple collateral assets&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should allow an account to have deposited multiple collateral assets&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:339,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const UserKresko = (0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user);\n// Load user account with a different type of collateral\nawait Collateral2.contract.setVariable(\&quot;_balances\&quot;, {\n    [_hardhat.default.users.userOne.address]: this.initialBalance\n});\nawait Collateral2.contract.setVariable(\&quot;_allowances\&quot;, {\n    [_hardhat.default.users.userOne.address]: {\n        [_hardhat.default.Diamond.address]: this.initialBalance\n    }\n});\n// Deposit batch of first collateral type\nawait (0, _chai.expect)(UserKresko.depositCollateral(depositArgs.user.address, this.collateral.address, depositArgs.amount)).not.to.be.reverted;\n// Deposit batch of second collateral type\nawait (0, _chai.expect)(UserKresko.depositCollateral(depositArgs.user.address, Collateral2.address, depositArgs.amount)).not.to.be.reverted;\n// Confirm the array of the user&#x27;s deposited collateral assets contains both collateral assets\nconst depositedCollateralAssetsAfter = await _hardhat.default.Diamond.getAccountCollateralAssets(depositArgs.user.address);\n(0, _chai.expect)(depositedCollateralAssetsAfter).to.deep.equal([\n    this.collateral.address,\n    Collateral2.address\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;307237d0-2820-483e-aa6b-7c2f0babf672&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit CollateralDeposited event&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should emit CollateralDeposited event&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:136,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tx = await (0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user).depositCollateral(depositArgs.user.address, this.collateral.address, depositArgs.amount);\nconst event = await (0, _lib.getInternalEvent)(tx, _hardhat.default.Diamond, \&quot;CollateralDeposited\&quot;);\n(0, _chai.expect)(event.account).to.equal(depositArgs.user.address);\n(0, _chai.expect)(event.collateralAsset).to.equal(this.collateral.address);\n(0, _chai.expect)(event.amount).to.equal(depositArgs.amount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eacc5e5f-3af7-45ef-99e0-25b52b7cd639&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if depositing collateral that has not been whitelisted&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should revert if depositing collateral that has not been whitelisted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:129,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user).depositCollateral(depositArgs.user.address, \&quot;0x0000000000000000000000000000000000000001\&quot;, depositArgs.amount)).to.be.revertedWith(_errors.Error.COLLATERAL_DOESNT_EXIST);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fb80a829-0e4b-42e4-9653-ad0d802e5e61&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if depositing an amount of 0&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should revert if depositing an amount of 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user).depositCollateral(depositArgs.user.address, this.collateral.address, 0)).to.be.revertedWith(_errors.Error.ZERO_DEPOSIT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bec111e5-0b0a-4ba8-a34a-ec82a515f1db&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if collateral is not depositable&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit should revert if collateral is not depositable&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:265,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { deployer , devTwo , extOne  } = await _hardhat.default.ethers.getNamedSigners();\nawait (0, _execution.executeContractCallWithSigners)(_hardhat.default.Multisig, _hardhat.default.Diamond, \&quot;toggleAssetsPaused\&quot;, [\n    [\n        this.collateral.address\n    ],\n    _testutils.Action.DEPOSIT,\n    true,\n    0\n], [\n    deployer,\n    devTwo,\n    extOne\n]);\nconst isDepositPaused = await _hardhat.default.Diamond.assetActionPaused(_testutils.Action.DEPOSIT.toString(), this.collateral.address);\n(0, _chai.expect)(isDepositPaused).to.equal(true);\nawait (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user).depositCollateral(depositArgs.user.address, this.collateral.contract.address, 0)).to.be.revertedWith(_errors.Error.ZERO_DEPOSIT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad91e1ba-e928-403f-bce2-8e32c46e8474&quot;,&quot;parentUUID&quot;:&quot;0977945d-bccf-4b33-adf3-c73d6534ac3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;631ed92a-92eb-482d-9500-303ef2a82c58&quot;,&quot;6645b567-2f75-4ee4-b287-b9cd5fa0a30a&quot;,&quot;a19cbfe8-9d6d-4d57-b2f0-8f8ee34fdbf9&quot;,&quot;c7c0975a-0c07-4d42-a0d2-7e3c9e397490&quot;,&quot;98d1cd1c-949e-42f7-9b41-a1c6a8b11bab&quot;,&quot;307237d0-2820-483e-aa6b-7c2f0babf672&quot;,&quot;eacc5e5f-3af7-45ef-99e0-25b52b7cd639&quot;,&quot;fb80a829-0e4b-42e4-9653-ad0d802e5e61&quot;,&quot;bec111e5-0b0a-4ba8-a34a-ec82a515f1db&quot;,&quot;ad91e1ba-e928-403f-bce2-8e32c46e8474&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3042,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000},{&quot;uuid&quot;:&quot;a2a46aa0-16ca-49bf-88ab-0deb1616ebb6&quot;,&quot;title&quot;:&quot;#withdraw&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;#withdraw\&quot;&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw \&quot;before each\&quot; hook in \&quot;#withdraw\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Deposit collateral\nawait (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, depositArgs.user).depositCollateral(depositArgs.user.address, this.collateral.contract.address, depositArgs.amount)).not.to.be.reverted;\nthis.collateral = this.collaterals[0];\nthis.depositAmount = depositArgs.amount;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;873853b4-ae97-4baf-9e27-c5d8f5f74974&quot;,&quot;parentUUID&quot;:&quot;a2a46aa0-16ca-49bf-88ab-0deb1616ebb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;77bbd910-85fa-42ec-aab8-e7abc28b975b&quot;,&quot;title&quot;:&quot;when the account&#x27;s minimum collateral value is 0&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow an account to withdraw their entire deposit&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 should allow an account to withdraw their entire deposit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:613,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const depositedCollateralAssets = await _hardhat.default.Diamond.getAccountCollateralAssets(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(depositedCollateralAssets).to.deep.equal([\n    this.collateral.address\n]);\nawait (0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, this.depositAmount, 0);\n// Ensure that the collateral asset is removed from the account&#x27;s deposited collateral\n// assets array.\nconst depositedCollateralAssetsPostWithdraw = await _hardhat.default.Diamond.getAccountCollateralAssets(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(depositedCollateralAssetsPostWithdraw).to.deep.equal([]);\n// Ensure the change in the user&#x27;s deposit is recorded.\nconst amountDeposited = await _hardhat.default.Diamond.getAccountCollateralAmount(_hardhat.default.users.userOne.address, this.collateral.address);\n(0, _chai.expect)(amountDeposited).to.equal(0);\n// Ensure the amount transferred is correct\nconst kreskoBalance = await this.collateral.contract.balanceOf(_hardhat.default.Diamond.address);\n(0, _chai.expect)(kreskoBalance).to.equal(0);\nconst userOneBalance = await this.collateral.contract.balanceOf(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(userOneBalance).to.equal(this.initialBalance);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d5817ed0-e0c0-4879-8eed-df51dfcc3195&quot;,&quot;parentUUID&quot;:&quot;77bbd910-85fa-42ec-aab8-e7abc28b975b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow an account to withdraw a portion of their deposit&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 should allow an account to withdraw a portion of their deposit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:508,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const withdrawAmount = this.depositAmount.div(2);\nawait (0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, withdrawAmount, 0);\n// Ensure the change in the user&#x27;s deposit is recorded.\nconst amountDeposited = await _hardhat.default.Diamond.getAccountCollateralAmount(_hardhat.default.users.userOne.address, this.collateral.address);\n(0, _chai.expect)(amountDeposited).to.equal(this.depositAmount.sub(withdrawAmount));\n// Ensure that the collateral asset is still in the account&#x27;s deposited collateral\n// assets array.\nconst depositedCollateralAssets = await _hardhat.default.Diamond.getAccountCollateralAssets(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(depositedCollateralAssets).to.deep.equal([\n    this.collateral.address\n]);\nconst kreskoBalance = await this.collateral.contract.balanceOf(_hardhat.default.Diamond.address);\n(0, _chai.expect)(kreskoBalance).to.equal(this.depositAmount.sub(withdrawAmount));\nconst userOneBalance = await this.collateral.contract.balanceOf(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(userOneBalance).to.equal(this.initialBalance.sub(amountDeposited));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9394fb91-25a4-40cc-8bb6-964b0ba6a867&quot;,&quot;parentUUID&quot;:&quot;77bbd910-85fa-42ec-aab8-e7abc28b975b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow trusted address to withdraw another accounts deposit&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 should allow trusted address to withdraw another accounts deposit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:666,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Grant userThree the MANAGER role\nawait _hardhat.default.Diamond.grantRole(_testutils.Role.MANAGER, _hardhat.default.users.userThree.address);\n(0, _chai.expect)(await _hardhat.default.Diamond.hasRole(_testutils.Role.MANAGER, _hardhat.default.users.userThree.address)).to.equal(true);\nconst collateralBefore = await _hardhat.default.Diamond.getAccountCollateralAmount(_hardhat.default.users.userOne.address, this.collateral.address);\nawait (0, _chai.expect)(UserKresko.withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, this.depositAmount, 0)).to.not.be.reverted;\nconst collateralAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(_hardhat.default.users.userOne.address, this.collateral.address);\n// Ensure that collateral was withdrawn\n(0, _chai.expect)(collateralAfter).to.equal(collateralBefore.sub(this.depositAmount));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ae3ac4e3-2458-4d66-98b8-29df5a4fd12e&quot;,&quot;parentUUID&quot;:&quot;77bbd910-85fa-42ec-aab8-e7abc28b975b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit CollateralWithdrawn event&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 should emit CollateralWithdrawn event&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:305,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const tx = await (0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, this.depositAmount, 0);\nconst event = await (0, _lib.getInternalEvent)(tx, _hardhat.default.Diamond, \&quot;CollateralWithdrawn\&quot;);\n(0, _chai.expect)(event.account).to.equal(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(event.collateralAsset).to.equal(this.collateral.address);\n(0, _chai.expect)(event.amount).to.equal(this.depositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;06499362-22d7-4ac3-945b-26819e956c4f&quot;,&quot;parentUUID&quot;:&quot;77bbd910-85fa-42ec-aab8-e7abc28b975b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow untrusted address to withdraw another accounts deposit&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 should not allow untrusted address to withdraw another accounts deposit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await (0, _chai.expect)(UserKresko.withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, this.initialBalance, 0)).to.be.revertedWith(`AccessControl: account ${_hardhat.default.users.userThree.address.toLowerCase()} is missing role 0x46925e0f0cc76e485772167edccb8dc449d43b23b55fc4e756b063f49099e6a0`);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8fcf2d5a-174e-4adc-a774-fa631c625ce8&quot;,&quot;parentUUID&quot;:&quot;77bbd910-85fa-42ec-aab8-e7abc28b975b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a360aafa-2d4d-40dc-bbd2-32d82d7d156b&quot;,&quot;title&quot;:&quot;when the account&#x27;s minimum collateral value is &gt; 0&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;when the account&#x27;s minimum collateral value is &gt; 0\&quot;&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 when the account&#x27;s minimum collateral value is &gt; 0 \&quot;before each\&quot; hook in \&quot;when the account&#x27;s minimum collateral value is &gt; 0\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:676,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.krAsset = _hardhat.default.krAssets.find((asset)=&gt;asset.deployArgs.symbol === _testutils.defaultKrAssetArgs.symbol);\n// userOne mints some kr assets\nthis.mintAmount = (0, _lib.toBig)(100);\nawait (0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).mintKreskoAsset(_hardhat.default.users.userOne.address, this.krAsset.address, this.mintAmount);\n// Mint amount differs from deposited amount due to open fee\nconst amountDeposited = await _hardhat.default.Diamond.getAccountCollateralAmount(_hardhat.default.users.userOne.address, this.collateral.address);\nthis.initialUserOneDeposited = amountDeposited;\nthis.mcr = await _hardhat.default.Diamond.getMinCollateralRatio();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db7a7475-023f-4319-a2da-a9727f938540&quot;,&quot;parentUUID&quot;:&quot;a360aafa-2d4d-40dc-bbd2-32d82d7d156b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow an account to withdraw their deposit if it does not violate the health factor&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 when the account&#x27;s minimum collateral value is &gt; 0 should allow an account to withdraw their deposit if it does not violate the health factor&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1567,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const withdrawAmount = (0, _lib.toBig)(10);\n// Ensure that the withdrawal would not put the account&#x27;s collateral value\n// less than the account&#x27;s minimum collateral value:\nconst [accMinCollateralValue, accCollateralValue, withdrawnCollateralValue] = await Promise.all([\n    _hardhat.default.Diamond.getAccountMinCollateralAtRatio(_hardhat.default.users.userOne.address, this.mcr),\n    _hardhat.default.Diamond.getAccountCollateralValue(_hardhat.default.users.userOne.address),\n    _hardhat.default.Diamond.getCollateralAmountToValue(this.collateral.address, withdrawAmount, false).then(([value])=&gt;value)\n]);\n(0, _chai.expect)(accCollateralValue.sub(withdrawnCollateralValue).gte(accMinCollateralValue)).to.be.true;\nawait (0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, withdrawAmount, 0);\n// Ensure that the collateral asset is still in the account&#x27;s deposited collateral\n// assets array.\nconst depositedCollateralAssets = await _hardhat.default.Diamond.getAccountCollateralAssets(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(depositedCollateralAssets).to.deep.equal([\n    this.collateral.address\n]);\n// Ensure the change in the user&#x27;s deposit is recorded.\nconst amountDeposited = await _hardhat.default.Diamond.getAccountCollateralAmount(_hardhat.default.users.userOne.address, this.collateral.address);\n(0, _chai.expect)(amountDeposited).to.equal(this.depositAmount.sub(withdrawAmount));\n// Check the balances of the contract and user\nconst kreskoBalance = await this.collateral.contract.balanceOf(_hardhat.default.Diamond.address);\n(0, _chai.expect)(kreskoBalance).to.equal(this.depositAmount.sub(withdrawAmount));\nconst userOneBalance = await this.collateral.contract.balanceOf(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(userOneBalance).to.equal(this.initialBalance.sub(this.depositAmount.sub(withdrawAmount)));\n// Ensure the account&#x27;s minimum collateral value is &lt;= the account collateral value\nconst accountMinCollateralValueAfter = await _hardhat.default.Diamond.getAccountMinCollateralAtRatio(_hardhat.default.users.userOne.address, this.mcr);\nconst accountCollateralValueAfter = await _hardhat.default.Diamond.getAccountCollateralValue(_hardhat.default.users.userOne.address);\n(0, _chai.expect)(accountMinCollateralValueAfter.lte(accountCollateralValueAfter)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;897242f3-0887-4999-882c-81c7085ad873&quot;,&quot;parentUUID&quot;:&quot;a360aafa-2d4d-40dc-bbd2-32d82d7d156b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow withdraws that exceed deposits and only send the user total deposit available&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 when the account&#x27;s minimum collateral value is &gt; 0 should allow withdraws that exceed deposits and only send the user total deposit available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:536,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const user = _hardhat.default.users.userFour;\nawait this.collateral.setBalance(user, _ethers.BigNumber.from(0));\nawait this.collateral.setBalance(user, (0, _lib.toBig)(1000));\nawait this.collateral.contract.connect(user).approve(_hardhat.default.Diamond.address, _hardhat.default.ethers.constants.MaxUint256);\nawait (0, _collaterals.depositCollateral)({\n    asset: this.collateral,\n    amount: (0, _lib.toBig)(1000),\n    user\n});\nawait (0, _collaterals.withdrawCollateral)({\n    asset: this.collateral,\n    amount: (0, _lib.toBig)(1010),\n    user\n});\n(0, _chai.expect)(await this.collateral.contract.balanceOf(user.address)).to.equal((0, _lib.toBig)(1000));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8604d448-552e-4098-b81c-d35d358d0c1f&quot;,&quot;parentUUID&quot;:&quot;a360aafa-2d4d-40dc-bbd2-32d82d7d156b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if withdrawing an amount of 0&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 when the account&#x27;s minimum collateral value is &gt; 0 should revert if withdrawing an amount of 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:134,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const withdrawAmount = 0;\nawait (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, 0, withdrawAmount)).to.be.revertedWith(_errors.Error.ZERO_WITHDRAW);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;44067a1f-85b7-4bdb-9ab0-39196a679018&quot;,&quot;parentUUID&quot;:&quot;a360aafa-2d4d-40dc-bbd2-32d82d7d156b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if the withdrawal violates the health factor&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 when the account&#x27;s minimum collateral value is &gt; 0 should revert if the withdrawal violates the health factor&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1031,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// userOne has a debt position, so attempting to withdraw the entire collateral deposit should be impossible\nconst withdrawAmount = this.initialBalance;\n// Ensure that the withdrawal would in fact put the account&#x27;s collateral value\n// less than the account&#x27;s minimum collateral value:\nconst accountMinCollateralValue = await _hardhat.default.Diamond.getAccountMinCollateralAtRatio(_hardhat.default.users.userOne.address, this.mcr);\nconst accountCollateralValue = await _hardhat.default.Diamond.getAccountCollateralValue(_hardhat.default.users.userOne.address);\nconst [withdrawnCollateralValue] = await _hardhat.default.Diamond.getCollateralAmountToValue(this.collateral.address, withdrawAmount, false);\n(0, _chai.expect)(accountCollateralValue.sub(withdrawnCollateralValue).lt(accountMinCollateralValue)).to.be.true;\nawait (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, withdrawAmount, 0)).to.be.revertedWith(_errors.Error.COLLATERAL_INSUFFICIENT_AMOUNT);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d34748ec-1376-4edf-8699-ac7112b90e63&quot;,&quot;parentUUID&quot;:&quot;a360aafa-2d4d-40dc-bbd2-32d82d7d156b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if the depositedCollateralAssetIndex is incorrect&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw when the account&#x27;s minimum collateral value is 0 when the account&#x27;s minimum collateral value is &gt; 0 should revert if the depositedCollateralAssetIndex is incorrect&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const withdrawAmount = this.depositAmount.div(2);\nawait (0, _chai.expect)((0, _redstone.wrapKresko)(_hardhat.default.Diamond, _hardhat.default.users.userOne).withdrawCollateral(_hardhat.default.users.userOne.address, this.collateral.address, withdrawAmount, 1)).to.be.revertedWith(_errors.Error.ARRAY_OUT_OF_BOUNDS);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d3500fb9-513a-4f11-b4fe-c76215204af8&quot;,&quot;parentUUID&quot;:&quot;a360aafa-2d4d-40dc-bbd2-32d82d7d156b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;897242f3-0887-4999-882c-81c7085ad873&quot;,&quot;8604d448-552e-4098-b81c-d35d358d0c1f&quot;,&quot;44067a1f-85b7-4bdb-9ab0-39196a679018&quot;,&quot;d34748ec-1376-4edf-8699-ac7112b90e63&quot;,&quot;d3500fb9-513a-4f11-b4fe-c76215204af8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3417,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000}],&quot;passes&quot;:[&quot;d5817ed0-e0c0-4879-8eed-df51dfcc3195&quot;,&quot;9394fb91-25a4-40cc-8bb6-964b0ba6a867&quot;,&quot;ae3ac4e3-2458-4d66-98b8-29df5a4fd12e&quot;,&quot;06499362-22d7-4ac3-945b-26819e956c4f&quot;,&quot;8fcf2d5a-174e-4adc-a774-fa631c625ce8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2205,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000},{&quot;uuid&quot;:&quot;3e844b6e-ea8f-4cd3-8ffd-ff51dd3e104f&quot;,&quot;title&quot;:&quot;#deposit - rebase events&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;#deposit - rebase events\&quot;&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events \&quot;before each\&quot; hook in \&quot;#deposit - rebase events\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:590,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await this.collateral.setBalance(user, this.initialBalance, _hardhat.default.Diamond.address);\n// Add krAsset as a collateral with anchor and cFactor of 1\n// Allowance for Kresko\nawait KreskoAssetCollateral.contract.setVariable(\&quot;_allowances\&quot;, {\n    [user.address]: {\n        [_hardhat.default.Diamond.address]: _hardhat.default.ethers.constants.MaxInt256\n    }\n});\n// Deposit some collateral\nawait UserKresko.depositCollateral(user.address, this.collateral.address, depositArgs.amount);\n// Mint some krAssets\nawait UserKresko.mintKreskoAsset(user.address, KreskoAssetCollateral.address, mintAmount);\n// Deposit all debt on tests\nthis.krAssetCollateralAmount = await UserKresko.getAccountDebtAmount(user.address, KreskoAssetCollateral.address);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;35bd2575-a52d-46d3-bc02-04b38bd9258d&quot;,&quot;parentUUID&quot;:&quot;3e844b6e-ea8f-4cd3-8ffd-ff51dd3e104f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;af41569a-f976-4b33-842a-105138eb76a1&quot;,&quot;title&quot;:&quot;deposit amounts are calculated correctly&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;when deposit is made before positive rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit amounts are calculated correctly when deposit is made before positive rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:325,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\n// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst expectedDepositsAfter = this.krAssetCollateralAmount.mul(denominator);\nconst depositsBefore = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is adjusted by the rebase\n(0, _chai.expect)(depositsBefore).to.not.bignumber.equal(finalDeposits);\n(0, _chai.expect)(finalDeposits).to.bignumber.equal(expectedDepositsAfter);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ef7d4520-aa13-4252-a39f-d3b0968fc922&quot;,&quot;parentUUID&quot;:&quot;af41569a-f976-4b33-842a-105138eb76a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made before negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit amounts are calculated correctly when deposit is made before negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:315,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst depositAmountAfterRebase = this.krAssetCollateralAmount.div(denominator);\n// Deposit\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\nconst depositsBefore = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is adjusted by the rebase\n(0, _chai.expect)(depositsBefore).to.not.bignumber.equal(finalDeposits);\n(0, _chai.expect)(finalDeposits).to.bignumber.equal(depositAmountAfterRebase);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;538ee909-2a44-4882-8df9-930b74d3a6b7&quot;,&quot;parentUUID&quot;:&quot;af41569a-f976-4b33-842a-105138eb76a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made after an positiveing rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit amounts are calculated correctly when deposit is made after an positiveing rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:311,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst depositAmount = this.krAssetCollateralAmount.mul(denominator);\nconst depositsBefore = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit after the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, depositAmount);\n// Get collateral deposits after\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is what was deposited as no rebases occured after\n(0, _chai.expect)(depositsBefore).to.not.bignumber.equal(finalDeposits);\n(0, _chai.expect)(finalDeposits).to.bignumber.equal(depositAmount);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;43f5aed9-b629-440a-88b1-b6f8a1417e6e&quot;,&quot;parentUUID&quot;:&quot;af41569a-f976-4b33-842a-105138eb76a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made after an negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit amounts are calculated correctly when deposit is made after an negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:328,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst depositAmount = this.krAssetCollateralAmount.div(denominator);\nconst depositsBefore = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit after the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, depositAmount);\n// Get collateral deposits after\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is what was deposited as no rebases occured after\n(0, _chai.expect)(depositsBefore).to.not.bignumber.equal(finalDeposits);\n(0, _chai.expect)(finalDeposits).to.bignumber.equal(depositAmount);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d6e6e016-1b48-44dc-9398-1056c6e8e4c4&quot;,&quot;parentUUID&quot;:&quot;af41569a-f976-4b33-842a-105138eb76a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made before and after a positiveing rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit amounts are calculated correctly when deposit is made before and after a positiveing rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:723,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\n// Deposit half before, half after\nconst halfDepositBeforeRebase = this.krAssetCollateralAmount.div(2);\nconst halfDepositAfterRebase = this.krAssetCollateralAmount.div(2).mul(denominator);\nconst fullDepositAmount = this.krAssetCollateralAmount.mul(denominator);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositBeforeRebase);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get deposits after\nconst depositsAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is adjusted by the rebase\n(0, _chai.expect)(depositsAfter).to.bignumber.equal(halfDepositAfterRebase);\n// Deposit second time\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositAfterRebase);\n// Get deposits after\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalDeposits).to.bignumber.equal(fullDepositAmount);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fab896ef-aa13-4efe-9b8d-0966ca9328b4&quot;,&quot;parentUUID&quot;:&quot;af41569a-f976-4b33-842a-105138eb76a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made before and after a negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit amounts are calculated correctly when deposit is made before and after a negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:433,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\n// Deposit half before, half after\nconst halfDepositBeforeRebase = this.krAssetCollateralAmount.div(2);\nconst halfDepositAfterRebase = this.krAssetCollateralAmount.div(2).div(denominator);\nconst fullDepositAmount = this.krAssetCollateralAmount.div(denominator);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositBeforeRebase);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get deposits after\nconst depositsAfterRebase = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is adjusted by the rebase\n(0, _chai.expect)(depositsAfterRebase).to.bignumber.equal(halfDepositAfterRebase);\n// Deposit second time\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositAfterRebase);\n// Get deposits after\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalDeposits).to.bignumber.equal(fullDepositAmount);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;de247c4e-c2d7-48bc-abb8-6ca1995f497a&quot;,&quot;parentUUID&quot;:&quot;af41569a-f976-4b33-842a-105138eb76a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ef7d4520-aa13-4252-a39f-d3b0968fc922&quot;,&quot;538ee909-2a44-4882-8df9-930b74d3a6b7&quot;,&quot;43f5aed9-b629-440a-88b1-b6f8a1417e6e&quot;,&quot;d6e6e016-1b48-44dc-9398-1056c6e8e4c4&quot;,&quot;fab896ef-aa13-4efe-9b8d-0966ca9328b4&quot;,&quot;de247c4e-c2d7-48bc-abb8-6ca1995f497a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2435,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000},{&quot;uuid&quot;:&quot;cfcb3df1-81cb-4187-86a8-e2c28cd0e4bb&quot;,&quot;title&quot;:&quot;deposit usd values are calculated correctly&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;when deposit is made before positiveing rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit usd values are calculated correctly when deposit is made before positiveing rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:886,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\nconst valueBefore = await _hardhat.default.Diamond.getAccountCollateralValue(user.address);\n// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\nKreskoAssetCollateral.setPrice(newPrice);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get collateral value of account after\nconst valueAfter = await _hardhat.default.Diamond.getAccountCollateralValue(user.address);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(valueBefore).to.bignumber.equal(valueAfter);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5beb0fcd-d6ba-4c89-b4c9-5ce24d202bbc&quot;,&quot;parentUUID&quot;:&quot;cfcb3df1-81cb-4187-86a8-e2c28cd0e4bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made before negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit usd values are calculated correctly when deposit is made before negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:652,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\nconst valueBefore = await _hardhat.default.Diamond.getAccountCollateralValue(user.address);\n// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) * denominator;\nKreskoAssetCollateral.setPrice(newPrice);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get collateral value of account after\nconst valueAfter = await _hardhat.default.Diamond.getAccountCollateralValue(user.address);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(valueBefore).to.bignumber.equal(valueAfter);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4afc43fc-f211-4c5f-ac2a-78b8c2be44f4&quot;,&quot;parentUUID&quot;:&quot;cfcb3df1-81cb-4187-86a8-e2c28cd0e4bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made after an positiveing rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit usd values are calculated correctly when deposit is made after an positiveing rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:711,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\n// Get expected value before rebase and deposit\nconst [expectedValue] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, this.krAssetCollateralAmount, false);\nconst depositAmount = this.krAssetCollateralAmount.mul(denominator);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit rebased amount after\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, depositAmount);\n// Get collateral value of account after\nconst [valueAfter] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, depositAmount, false);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(expectedValue).to.bignumber.equal(valueAfter);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2387de1c-8021-4d13-af08-5f83073bf9f7&quot;,&quot;parentUUID&quot;:&quot;cfcb3df1-81cb-4187-86a8-e2c28cd0e4bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made after an negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit usd values are calculated correctly when deposit is made after an negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:472,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) * denominator;\n// Get expected value before rebase and deposit\nconst [expectedValue] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, this.krAssetCollateralAmount, false);\nconst depositAmount = this.krAssetCollateralAmount.div(denominator);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit rebased amount after\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, depositAmount);\n// Get collateral value of account after\nconst [valueAfter] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, depositAmount, false);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(expectedValue).to.bignumber.equal(valueAfter);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;86690448-c446-47c1-80d8-c062c73ae3d0&quot;,&quot;parentUUID&quot;:&quot;cfcb3df1-81cb-4187-86a8-e2c28cd0e4bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made before and after a positiveing rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit usd values are calculated correctly when deposit is made before and after a positiveing rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1185,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\n// Deposit half before, half after\nconst halfDepositBeforeRebase = this.krAssetCollateralAmount.div(2);\nconst halfDepositAfterRebase = this.krAssetCollateralAmount.div(2).mul(denominator);\nconst fullDepositAmount = this.krAssetCollateralAmount.mul(denominator);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositBeforeRebase);\nconst [expectedValue] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, halfDepositBeforeRebase, false);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get value after\nconst [valueAfterRebase] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, halfDepositAfterRebase, false);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(expectedValue).to.bignumber.equal(valueAfterRebase);\n// Calculate added value since price adjusted in the rebase\nconst [expectedValueAfterSecondDeposit] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, fullDepositAmount, false);\n// Deposit more\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositAfterRebase);\n// Get value\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(finalValue).to.bignumber.equal(expectedValueAfterSecondDeposit);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bad4188b-b12e-4dba-b5fc-0ef1ff3092d5&quot;,&quot;parentUUID&quot;:&quot;cfcb3df1-81cb-4187-86a8-e2c28cd0e4bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when deposit is made before and after a negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #deposit - rebase events deposit usd values are calculated correctly when deposit is made before and after a negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1002,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) * denominator;\n// Deposit half before, half after\nconst halfDepositBeforeRebase = this.krAssetCollateralAmount.div(2);\nconst halfDepositAfterRebase = this.krAssetCollateralAmount.div(2).div(denominator);\nconst fullDepositAmount = this.krAssetCollateralAmount.div(denominator);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositBeforeRebase);\nconst [expectedValue] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, halfDepositBeforeRebase, false);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get value after\nconst [valueAfterRebase] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, halfDepositAfterRebase, false);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(expectedValue).to.bignumber.equal(valueAfterRebase);\n// Calculate added value since price adjusted in the rebase\nconst [expectedValueAfterSecondDeposit] = await _hardhat.default.Diamond.getCollateralAmountToValue(KreskoAssetCollateral.address, fullDepositAmount, false);\n// Deposit more\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, halfDepositAfterRebase);\n// Get deposits after\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(finalValue).to.bignumber.equal(expectedValueAfterSecondDeposit);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4ce5efe6-a946-4294-9dea-9cdc82189e03&quot;,&quot;parentUUID&quot;:&quot;cfcb3df1-81cb-4187-86a8-e2c28cd0e4bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5beb0fcd-d6ba-4c89-b4c9-5ce24d202bbc&quot;,&quot;4afc43fc-f211-4c5f-ac2a-78b8c2be44f4&quot;,&quot;2387de1c-8021-4d13-af08-5f83073bf9f7&quot;,&quot;86690448-c446-47c1-80d8-c062c73ae3d0&quot;,&quot;bad4188b-b12e-4dba-b5fc-0ef1ff3092d5&quot;,&quot;4ce5efe6-a946-4294-9dea-9cdc82189e03&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4908,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000},{&quot;uuid&quot;:&quot;4e31778a-e0dd-4cc7-869f-da92720e80a2&quot;,&quot;title&quot;:&quot;#withdraw - rebase events&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;#withdraw - rebase events\&quot;&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events \&quot;before each\&quot; hook in \&quot;#withdraw - rebase events\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:576,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await this.collateral.setBalance(user, this.initialBalance, _hardhat.default.Diamond.address);\n// Add krAsset as a collateral with anchor and cFactor of 1\n// await hre.Diamond.addCollateralAsset(\n//     this.krAsset!.contract.address,\n//     ...(await getCollateralConfig(\n//         this.krAsset.contract,\n//         this.krAsset!.anchor!.address,\n//         toBig(1),\n//         toBig(1.05),\n//         await hre.Diamond.getFeedForAddress(this.krAsset.address, OracleType.Chainlink),\n//     )),\n// );\nawait KreskoAssetCollateral.contract.setVariable(\&quot;_allowances\&quot;, {\n    [user.address]: {\n        [_hardhat.default.Diamond.address]: _hardhat.default.ethers.constants.MaxInt256\n    }\n});\n// Deposit some collateral\nawait UserKresko.depositCollateral(user.address, this.collateral.address, depositArgs.amount);\n// Mint some krAssets\nawait UserKresko.mintKreskoAsset(user.address, KreskoAssetCollateral.address, mintAmount);\n// Deposit all debt on tests\nthis.krAssetCollateralAmount = await UserKresko.getAccountDebtAmount(user.address, KreskoAssetCollateral.address);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;32616df2-74e4-4b12-912e-7b3cd4803ecd&quot;,&quot;parentUUID&quot;:&quot;4e31778a-e0dd-4cc7-869f-da92720e80a2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;title&quot;:&quot;withdraw amounts are calculated correctly&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;when withdrawing a deposit made before positive rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw amounts are calculated correctly when withdrawing a deposit made before positive rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1049,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst rebasedDepositAmount = this.krAssetCollateralAmount.mul(denominator);\n// Deposit collateral before rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst depositsAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is adjusted by the rebase\n(0, _chai.expect)(depositsAfter).to.bignumber.equal(rebasedDepositAmount);\n// Withdraw rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount, cIndex);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\nconst finalBalance = await KreskoAssetCollateral.contract.balanceOf(user.address);\n(0, _chai.expect)(finalDeposits).to.equal(0);\n(0, _chai.expect)(finalBalance).to.equal(rebasedDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f88b377d-4375-4267-9b0c-515af55e112e&quot;,&quot;parentUUID&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made before negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw amounts are calculated correctly when withdrawing a deposit made before negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:881,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst rebasedDepositAmount = this.krAssetCollateralAmount.div(denominator);\n// Deposit collateral before rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst depositsAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is adjusted by the rebase\n(0, _chai.expect)(depositsAfter).to.bignumber.equal(rebasedDepositAmount);\n// Withdraw rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount, cIndex);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\nconst finalBalance = await KreskoAssetCollateral.contract.balanceOf(user.address);\n(0, _chai.expect)(finalDeposits).to.equal(0);\n(0, _chai.expect)(finalBalance).to.equal(rebasedDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6906463d-2431-44ea-ac0b-10b39520bf77&quot;,&quot;parentUUID&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made after an positive rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw amounts are calculated correctly when withdrawing a deposit made after an positive rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:921,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst rebasedDepositAmount = this.krAssetCollateralAmount.mul(denominator);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit after the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Get collateral deposits after\nconst depositsAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is what was deposited as no rebases occured after\n(0, _chai.expect)(depositsAfter).to.bignumber.equal(rebasedDepositAmount);\n// Withdraw rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount, cIndex);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\nconst finalBalance = await KreskoAssetCollateral.contract.balanceOf(user.address);\n(0, _chai.expect)(finalDeposits).to.equal(0);\n(0, _chai.expect)(finalBalance).to.equal(rebasedDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b05c4e1a-51d5-456d-8c3c-68b4a30bb641&quot;,&quot;parentUUID&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made after an negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw amounts are calculated correctly when withdrawing a deposit made after an negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1095,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst rebasedDepositAmount = this.krAssetCollateralAmount.div(denominator);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit after the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Get collateral deposits after\nconst depositsAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral balance is what was deposited as no rebases occured after\n(0, _chai.expect)(depositsAfter).to.bignumber.equal(rebasedDepositAmount);\n// Withdraw rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount, cIndex);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\nconst finalBalance = await KreskoAssetCollateral.contract.balanceOf(user.address);\n(0, _chai.expect)(finalDeposits).to.equal(0);\n(0, _chai.expect)(finalBalance).to.equal(rebasedDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f4aabbc6-aa6f-4997-81f6-8de8826c0bcc&quot;,&quot;parentUUID&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made before and after a positive rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw amounts are calculated correctly when withdrawing a deposit made before and after a positive rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1265,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\n// Deposit half before, half (rebase adjusted) after\nconst firstDepositAmount = this.krAssetCollateralAmount.div(2);\nconst secondDepositAmount = this.krAssetCollateralAmount.div(2).mul(denominator);\nconst fullDepositAmount = this.krAssetCollateralAmount.mul(denominator);\n// Deposit before the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, firstDepositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Get deposits before\nconst depositsFirst = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(depositsFirst).to.bignumber.equal(firstDepositAmount);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit after the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, secondDepositAmount);\n// Get collateral deposits after\nconst depositsAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure deposit balance matches expected\n(0, _chai.expect)(depositsAfter).to.bignumber.equal(fullDepositAmount);\n// Withdraw rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, fullDepositAmount, cIndex);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\nconst finalBalance = await KreskoAssetCollateral.contract.balanceOf(user.address);\n(0, _chai.expect)(finalDeposits).to.equal(0);\n(0, _chai.expect)(finalBalance).to.equal(fullDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;149f8a97-de3e-4f6c-b1a2-9af6f719b79b&quot;,&quot;parentUUID&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made before and after a negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw amounts are calculated correctly when withdrawing a deposit made before and after a negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1141,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\n// Deposit half before, half (rebase adjusted) after\nconst firstDepositAmount = this.krAssetCollateralAmount.div(2);\nconst secondDepositAmount = this.krAssetCollateralAmount.div(2).div(denominator);\nconst fullDepositAmount = this.krAssetCollateralAmount.div(denominator);\n// Deposit before the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, firstDepositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Get deposits before\nconst depositsFirst = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(depositsFirst).to.bignumber.equal(firstDepositAmount);\n// Rebase the asset according to params\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit after the rebase\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, secondDepositAmount);\n// Get collateral deposits after\nconst depositsAfter = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\n// Ensure deposit balance matches expected\n(0, _chai.expect)(depositsAfter).to.bignumber.equal(fullDepositAmount);\n// Withdraw rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, fullDepositAmount, cIndex);\nconst finalDeposits = await _hardhat.default.Diamond.getAccountCollateralAmount(user.address, KreskoAssetCollateral.address);\nconst finalBalance = await KreskoAssetCollateral.contract.balanceOf(user.address);\n(0, _chai.expect)(finalDeposits).to.equal(0);\n(0, _chai.expect)(finalBalance).to.bignumber.equal(fullDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7ed2d17c-fa1b-4f42-aeb1-660adf9502e6&quot;,&quot;parentUUID&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a non-rebased collateral after a rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw amounts are calculated correctly when withdrawing a non-rebased collateral after a rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:755,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\nconst withdrawAmount = (0, _lib.toBig)(10);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\nconst nrcBalanceBefore = await this.collateral.contract.balanceOf(user.address);\nconst expectedNrcBalanceAfter = nrcBalanceBefore.add(withdrawAmount);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, this.collateral.address);\nawait UserKresko.withdrawCollateral(user.address, this.collateral.address, withdrawAmount, cIndex);\n(0, _chai.expect)(await this.collateral.contract.balanceOf(user.address)).to.bignumber.equal(expectedNrcBalanceAfter);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c4f085c-2a14-4478-846b-e41054c70f32&quot;,&quot;parentUUID&quot;:&quot;c41db107-19ee-4281-8d2e-cc0e079ce835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f88b377d-4375-4267-9b0c-515af55e112e&quot;,&quot;6906463d-2431-44ea-ac0b-10b39520bf77&quot;,&quot;b05c4e1a-51d5-456d-8c3c-68b4a30bb641&quot;,&quot;f4aabbc6-aa6f-4997-81f6-8de8826c0bcc&quot;,&quot;149f8a97-de3e-4f6c-b1a2-9af6f719b79b&quot;,&quot;7ed2d17c-fa1b-4f42-aeb1-660adf9502e6&quot;,&quot;1c4f085c-2a14-4478-846b-e41054c70f32&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7107,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000},{&quot;uuid&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;title&quot;:&quot;withdraw usd values are calculated correctly&quot;,&quot;fullFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;file&quot;:&quot;/src/test/minter/02-deposit-withdraw.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;when withdrawing a deposit made before positive rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw usd values are calculated correctly when withdrawing a deposit made before positive rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:873,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\nconst rebasedDepositAmount = this.krAssetCollateralAmount.mul(denominator);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount, cIndex);\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalValue).to.equal(0);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(rebasedDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;023bb3e6-7e8b-4151-b59d-fa9da8444e45&quot;,&quot;parentUUID&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made before negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw usd values are calculated correctly when withdrawing a deposit made before negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1086,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) * denominator;\nconst rebasedDepositAmount = this.krAssetCollateralAmount.div(denominator);\n// Deposit\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Withdraw the full rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, rebasedDepositAmount, cIndex);\n// Get value\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalValue).to.equal(0);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(rebasedDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9edc5066-1172-49bf-af80-64d129f9b5cd&quot;,&quot;parentUUID&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrwaing a deposit made after an positiveing rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw usd values are calculated correctly when withdrwaing a deposit made after an positiveing rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1079,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\nconst depositAmount = this.krAssetCollateralAmount.mul(denominator);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit rebased amount after\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, depositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Withdraw the full rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, depositAmount, cIndex);\n// Get value\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalValue).to.equal(0);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(depositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d75598f7-90a7-40d0-b3b4-5607a06918aa&quot;,&quot;parentUUID&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made after an negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw usd values are calculated correctly when withdrawing a deposit made after an negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:846,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) * denominator;\nconst depositAmount = this.krAssetCollateralAmount.div(denominator);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Deposit rebased amount after\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, depositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Withdraw the full rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, depositAmount, cIndex);\n// Get value\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalValue).to.equal(0);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(depositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75ac9b1e-0116-4f22-9357-3030ea1e5bba&quot;,&quot;parentUUID&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made before and after a positive rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw usd values are calculated correctly when withdrawing a deposit made before and after a positive rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1338,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\n// Deposit half before, half after\nconst firstDepositAmount = this.krAssetCollateralAmount.div(2);\nconst secondDepositAmount = this.krAssetCollateralAmount.div(2).mul(denominator);\nconst fullDepositAmount = this.krAssetCollateralAmount.mul(denominator);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, firstDepositAmount);\nconst [expectedValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get value after\nconst [valueAfterRebase] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(expectedValue).to.bignumber.equal(valueAfterRebase);\n// Deposit more\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, secondDepositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Withdraw the full rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, fullDepositAmount, cIndex);\n// Get value\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalValue).to.equal(0);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(fullDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a043eb91-f212-498c-9388-bf42d68a764c&quot;,&quot;parentUUID&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a deposit made before and after a negative rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw usd values are calculated correctly when withdrawing a deposit made before and after a negative rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1560,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = false;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) * denominator;\n// Deposit half before, half after\nconst firstDepositAmount = this.krAssetCollateralAmount.div(2);\nconst secondDepositAmount = this.krAssetCollateralAmount.div(denominator).div(2);\nconst fullDepositAmount = this.krAssetCollateralAmount.div(denominator);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, firstDepositAmount);\nconst [expectedValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\n// Get value after\nconst [valueAfterRebase] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n// Ensure that the collateral value stays the same\n(0, _chai.expect)(expectedValue).to.bignumber.equal(valueAfterRebase);\n// Deposit more\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, secondDepositAmount);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, KreskoAssetCollateral.address);\n// Withdraw the full rebased amount\nawait UserKresko.withdrawCollateral(user.address, KreskoAssetCollateral.address, fullDepositAmount, cIndex);\n// Get value\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, KreskoAssetCollateral.address);\n(0, _chai.expect)(finalValue).to.equal(0);\n(0, _chai.expect)(await KreskoAssetCollateral.contract.balanceOf(user.address)).to.bignumber.equal(fullDepositAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0ace9575-58d2-4b89-8703-ebab040f967c&quot;,&quot;parentUUID&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;when withdrawing a non-rebased collateral after a rebase&quot;,&quot;fullTitle&quot;:&quot;Minter - Deposit Withdraw #collateral #withdraw - rebase events withdraw usd values are calculated correctly when withdrawing a non-rebased collateral after a rebase&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1947,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Rebase params\nconst denominator = 4;\nconst positive = true;\nconst newPrice = (0, _lib.fromBig)(await KreskoAssetCollateral.getPrice(), 8) / denominator;\nconst withdrawAmount = (0, _lib.toBig)(10);\nawait UserKresko.depositCollateral(user.address, KreskoAssetCollateral.address, this.krAssetCollateralAmount);\nconst accountValueBefore = await _hardhat.default.Diamond.getAccountCollateralValue(user.address);\nconst [nrcValueBefore] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, this.collateral.address);\nconst [withdrawValue] = await _hardhat.default.Diamond.getCollateralAmountToValue(this.collateral.address, withdrawAmount, false);\nconst expectedNrcValueAfter = nrcValueBefore.sub(withdrawValue);\n// Rebase the asset according to params\nKreskoAssetCollateral.setPrice(newPrice);\nawait KreskoAssetCollateral.contract.rebase((0, _lib.toBig)(denominator), positive, []);\nconst cIndex = await _hardhat.default.Diamond.getAccountDepositIndex(user.address, this.collateral.address);\nawait UserKresko.withdrawCollateral(user.address, this.collateral.address, withdrawAmount, cIndex);\nconst finalAccountValue = await _hardhat.default.Diamond.getAccountCollateralValue(user.address);\nconst [finalValue] = await _hardhat.default.Diamond.getAccountCollateralValueOf(user.address, this.collateral.address);\n(0, _chai.expect)(finalValue).to.equal(expectedNrcValueAfter);\n(0, _chai.expect)(finalAccountValue).to.bignumber.equal(accountValueBefore.sub(withdrawValue));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fc3042b2-ef09-4f04-a53f-9f00e623ffb5&quot;,&quot;parentUUID&quot;:&quot;d52dbd44-ce9f-4e12-a1f0-8a8db7ddc163&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;023bb3e6-7e8b-4151-b59d-fa9da8444e45&quot;,&quot;9edc5066-1172-49bf-af80-64d129f9b5cd&quot;,&quot;d75598f7-90a7-40d0-b3b4-5607a06918aa&quot;,&quot;75ac9b1e-0116-4f22-9357-3030ea1e5bba&quot;,&quot;a043eb91-f212-498c-9388-bf42d68a764c&quot;,&quot;0ace9575-58d2-4b89-8703-ebab040f967c&quot;,&quot;fc3042b2-ef09-4f04-a53f-9f00e623ffb5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8729,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:60000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:60000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.2.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;kresko-protocol&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/Users/panukettunen/Projects/kresko-protocol/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>